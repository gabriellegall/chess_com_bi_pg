version: 2

models:
  - name: dwh_agg_games_with_moves
    description: "
      Multi-level aggregation of the games with moves table to construct summarized metrics. 
      Aggregation occurs at two independent levels: (1) `game_uuid` level (2) `game_uuid` x `game_phase` level.
      "
    columns:
      - name: username
        description: "{{ doc('username') }}"
      - name: uuid
        description: "{{ doc('uuid') }}"
      - name: eco
        description: "{{ doc('eco') }}"
      - name: game_phase
        description: "{{ doc('game_phase') }}"
      - name: url
        description: "{{ doc('url') }}"
      - name: end_time
        description: "{{ doc('end_time') }}"
      - name: end_time_date
        description: "{{ doc('end_time_date') }}"
      - name: end_time_month
        description: "{{ doc('end_time_month') }}"
      - name: playing_rating
        description: "{{ doc('playing_rating') }}"
      - name: playing_rating_range
        description: "{{ doc('playing_rating_range') }}"
      - name: opponent_rating
        description: "{{ doc('opponent_rating') }}"
      - name: opponent_rating_range
        description: "{{ doc('opponent_rating_range') }}"
      - name: playing_as
        description: "{{ doc('playing_as') }}"
      - name: playing_result
        description: "{{ doc('playing_result') }}"
      - name: time_class
        description: "{{ doc('time_class') }}"
      - name: nb_moves
        description : "{{ doc('nb_moves') }}"
      - name: aggregation_level
        description: "{{ doc('aggregation_level') }}"
      - name: game_phase_key
        description: "{{ doc('game_phase_key') }}"
      - name: nb_blunder_playing
        description: "{{ doc('nb_blunder_playing') }}"
      - name: nb_massive_blunder_playing
        description: "{{ doc('nb_massive_blunder_playing') }}"
      - name: nb_blunder_playing_early
        description: "
          {{ doc('nb_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_playing_early
        description: "
          {{ doc('nb_massive_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_blunder_playing_mid
        description: "
          {{ doc('nb_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_playing_mid
        description: "
          {{ doc('nb_massive_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_blunder_playing_late
        description: "
          {{ doc('nb_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_playing_late
        description: "
          {{ doc('nb_massive_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_blunder_playing_very_late
        description: "
          {{ doc('nb_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_massive_blunder_playing_very_late
        description: "
          {{ doc('nb_massive_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: massive_blunder_move_number_playing
        description: "{{ doc('massive_blunder_move_number_playing') }}"
      - name: nb_throw_playing
        description: "{{ doc('nb_throw_playing') }}"
      - name: nb_throw_blunder_playing
        description: "{{ doc('nb_throw_blunder_playing') }}"
      - name: nb_throw_massive_blunder_playing
        description: "{{ doc('nb_throw_massive_blunder_playing') }}"
      - name: nb_missed_opportunity_playing
        description: "{{ doc('nb_missed_opportunity_playing') }}"
      - name: nb_missed_opportunity_blunder_playing
        description: "{{ doc('nb_missed_opportunity_blunder_playing') }}"
      - name: nb_missed_opportunity_massive_blunder_playing
        description: "{{ doc('nb_missed_opportunity_massive_blunder_playing') }}"
      - name: nb_missed_opportunity_blunder_playing_early
        description: "
          {{ doc('nb_missed_opportunity_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_playing_early
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_playing_early
        description: "
          {{ doc('nb_throw_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_playing_early
        description: "
          {{ doc('nb_throw_massive_blunder_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_playing_mid
        description: "
          {{ doc('nb_missed_opportunity_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_playing_mid
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_playing_mid
        description: "
          {{ doc('nb_throw_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_playing_mid
        description: "
          {{ doc('nb_throw_massive_blunder_playing_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_playing_late
        description: "
          {{ doc('nb_missed_opportunity_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_playing_late
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_playing_late
        description: "
          {{ doc('nb_throw_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_playing_late
        description: "
          {{ doc('nb_throw_massive_blunder_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_playing_very_late
        description: "
          {{ doc('nb_missed_opportunity_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_missed_opportunity_massive_blunder_playing_very_late
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_throw_blunder_playing_very_late
        description: "
          {{ doc('nb_throw_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_throw_massive_blunder_playing_very_late
        description: "
          {{ doc('nb_throw_massive_blunder_playing_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_throw_opponent
        description: "{{ doc('nb_throw_opponent') }}"
      - name: nb_throw_blunder_opponent
        description: "{{ doc('nb_throw_blunder_opponent') }}"
      - name: nb_throw_massive_blunder_opponent
        description: "{{ doc('nb_throw_massive_blunder_opponent') }}"
      - name: nb_missed_opportunity_opponent
        description: "{{ doc('nb_missed_opportunity_opponent') }}"
      - name: nb_missed_opportunity_blunder_opponent
        description: "{{ doc('nb_missed_opportunity_blunder_opponent') }}"
      - name: nb_missed_opportunity_massive_blunder_opponent
        description: "{{ doc('nb_missed_opportunity_massive_blunder_opponent') }}"
      - name: nb_missed_opportunity_blunder_opponent_early
        description: "
          {{ doc('nb_missed_opportunity_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_opponent_early
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_opponent_early
        description: "
          {{ doc('nb_throw_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_opponent_early
        description: "
          {{ doc('nb_throw_massive_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_opponent_mid
        description: "
          {{ doc('nb_missed_opportunity_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_opponent_mid
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_opponent_mid
        description: "
          {{ doc('nb_throw_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_opponent_mid
        description: "
          {{ doc('nb_throw_massive_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_opponent_late
        description: "
          {{ doc('nb_missed_opportunity_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_massive_blunder_opponent_late
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_throw_blunder_opponent_late
        description: "
          {{ doc('nb_throw_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_throw_massive_blunder_opponent_late
        description: "
          {{ doc('nb_throw_massive_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_missed_opportunity_blunder_opponent_very_late
        description: "
          {{ doc('nb_missed_opportunity_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_missed_opportunity_massive_blunder_opponent_very_late
        description: "
          {{ doc('nb_missed_opportunity_massive_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_throw_blunder_opponent_very_late
        description: "
          {{ doc('nb_throw_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_throw_massive_blunder_opponent_very_late
        description: "
          {{ doc('nb_throw_massive_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_blunder_opponent_early
        description: "
          {{ doc('nb_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_opponent_early
        description: "
          {{ doc('nb_massive_blunder_opponent_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: nb_blunder_opponent_mid
        description: "
          {{ doc('nb_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_opponent_mid
        description: "
          {{ doc('nb_massive_blunder_opponent_mid') }}
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: nb_blunder_opponent_late
        description: "
          {{ doc('nb_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_massive_blunder_opponent_late
        description: "
          {{ doc('nb_massive_blunder_opponent_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: nb_blunder_opponent_very_late
        description: "
          {{ doc('nb_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: nb_massive_blunder_opponent_very_late
        description: "
          {{ doc('nb_massive_blunder_opponent_very_late') }}
          The very late game phase is defined from move {{ var('game_phases')['late']['end_game_move'] + 1 }} onwards.
          "
      - name: median_score_playing
        description: "{{ doc('median_score_playing') }}"
      - name: max_score_playing
        description: "{{ doc('max_score_playing') }}"
      - name: min_score_playing
        description: "{{ doc('min_score_playing') }}"
      - name: std_score_playing
        description: "{{ doc('std_score_playing') }}"
      - name: max_score_playing_range
        description: "{{ doc('max_score_playing_range') }}"
      - name: max_score_playing_type
        description: "
          {{ doc('max_score_playing_type') }}
          Any score above {{ var('should_win_range')['mid'] }} is considered a decisive advantage.
          "
      - name: time_control
        description: "{{ doc('time_control') }}"
      - name: first_blunder_playing_prct_time_remaining
        description: "{{ doc('first_blunder_playing_prct_time_remaining') }}"
      - name: first_massive_blunder_playing_prct_time_remaining
        description: "{{ doc('first_massive_blunder_playing_prct_time_remaining') }}"
      - name: first_missed_opp_massive_blunder_playing_prct_time_remaining
        description: "{{ doc('first_missed_opp_massive_blunder_playing_prct_time_remaining') }}"
      - name: first_throw_massive_blunder_playing_prct_time_remaining
        description: "{{ doc('first_throw_massive_blunder_playing_prct_time_remaining') }}"
      - name: nb_moves_above_decisive_advantage
        description: "
          {{ doc('nb_moves_above_decisive_advantage') }} 
          Any score above {{ var('should_win_range')['mid'] }} is considered a decisive advantage.
          "
      - name: prct_time_remaining_playing_early
        description: "
          {{ doc('prct_time_remaining_playing_early') }}
          The early game phase is defined from move 1 to {{ var('game_phases')['early']['end_game_move'] }}.
          "
      - name: prct_time_remaining_playing_mid
        description: "
          {{ doc('prct_time_remaining_playing_mid') }} 
          The mid game phase is defined from move {{ var('game_phases')['early']['end_game_move'] + 1 }} to {{ var('game_phases')['mid']['end_game_move'] }}.
          "
      - name: prct_time_remaining_playing_late
        description: "
          {{ doc('prct_time_remaining_playing_late') }}
          The late game phase is defined from move {{ var('game_phases')['mid']['end_game_move'] + 1 }} to {{ var('game_phases')['late']['end_game_move'] }}.
          "
      - name: opener_2_moves
        description: "{{ doc('opener_2_moves') }}"
      - name: opener_1_moves_playing
        description: "{{ doc('opener_1_moves_playing') }}"
      - name: opener_4_moves
        description: "{{ doc('opener_4_moves') }}"
      - name: opener_2_moves_playing
        description: "{{ doc('opener_2_moves_playing') }}"
      - name: opener_6_moves
        description: "{{ doc('opener_6_moves') }}"
      - name: opener_3_moves_playing
        description: "{{ doc('opener_3_moves_playing') }}"
      - name: opener_8_moves
        description: "{{ doc('opener_8_moves') }}"
      - name: opener_4_moves_playing
        description: "{{ doc('opener_4_moves_playing') }}"